---
title: 'Lab 2: Measuring Networks - Centrality and Global Measures'
author: "Tiernan Cahill"
date: "12/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Data and Required Packages
Rather than having to re-convert the raw data from Brandwatch into a graph object, we can serialize the existing graph objects from Lab 1 and import them directly into our environment here.

We will also need to load a few packages for this lab:

  - `magrittr` for handling pipes and enabling tidy workflows
  - `dplyr` for wrangling data
  - `igraph` for modelling and visualizing our network

```{r load, message = FALSE}
library(magrittr)
library(dplyr)
library(igraph)

mention_graph <- readRDS("../data/mention_graph.RDS")
htag_graph <- readRDS("../data/htag_graph.RDS")
htag_uses_graph <- readRDS("../data/htag_uses_graph.RDS")
```

# Node-Level Centrality

## Degree
```{r degree}
# Use the degree function to calculate the degree centrality of each node
degree(mention_graph) %>% head()

# Can be applied to the entire network (as above) or to selected nodes
degree(htag_graph, v = c("#michigan", "#pennsylvania", "#wisconsin", 
                         "#minnesota", "#northcarolina", "#arizona"))

# By default, calculates the total degree, but accepts flags for in-degree
# and out-degree in directed networks
pol_users <- c("MissouriGOP", "OHDems",
                     "joebiden", "realdonaldtrump")
data.frame(deg.out = degree(mention_graph, v = pol_users, mode = "out"),
           deg.in = degree(mention_graph, v = pol_users, mode = "in"))
```

```{r degree-append}
# Append degree centrality as a node-level attribute to store within the graph object
V(mention_graph)$deg.out <- degree(mention_graph, mode = "out")
V(mention_graph)$deg.in <- degree(mention_graph, mode = "in")
V(htag_graph)$deg <- degree(htag_graph, mode = "total")

# Let's take a look!
vertex_attr_names(mention_graph)
```

## Strength
*Weighted degree centrality*, also sometimes called *strength*, can be calculated using the `strength` function. All of the uses of the `degree` function shown above can also be applied here, and on unweighted networks, `degree` is automatically called instead.

```{r strength}
# Compare the weighted and unweighted degree centrality for a weighted network
V(htag_graph)$deg.weighted <- strength(htag_graph)

data.frame(Node = V(htag_graph)$name,
           Unweighted = V(htag_graph)$deg,
           Weighted = V(htag_graph)$deg.weighted) %>% head(20)
```

## Betweenness
Likewise, the `betweenness` function can be used to calculate the *betweenness centrality* of each node. Recall that betweenness counts the number of geodesics that pass through a given node. The `betweenness` function take edge weights into consideration by default (if the network is weighted), but this can be disabled by setting `weights = FALSE`.

```{r betweenness}
V(mention_graph)$betweenness <- betweenness(mention_graph, directed = TRUE)

# Let's take a look!
mention_centralities <- vertex.attributes(mention_graph) %>% 
  as.data.frame() %>% 
  select(name, deg.out, deg.in, betweenness)

mention_centralities %>% 
  arrange(desc(betweenness)) %>%
  head(20)
```

# Network-Level Measurements

## Size

## Density

## Components

## Degree Distribution

## Average Path Length

## Diameter

## Clustering Coefficient / Transitivity
